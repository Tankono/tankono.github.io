{"version":3,"file":"static/chunks/pages/install-6df7a581cd2244ab.js","mappings":"oFACA,CAAAA,OAAAC,QAAA,CAAAD,OAAAC,QAAA,MAAAC,IAAA,EACA,WACA,WACA,OAAeC,EAAQ,KACvB,EACA,gDCSKC,EAALA,qHAAKA,EAAAA,EAAAA,GAAAA,CAAAA,EAAAA,CAAAA,CAAAA,EAAAA,CAAAA,EACDC,SAAAA,CAAAA,EAAAA,CAAAA,YADCD,CAAAA,CAAAA,EAGDE,UAAAA,CAAAA,EAAAA,CAAAA,aAHCF,CAAAA,CAAAA,EAKDG,SAAAA,CAAAA,EAAAA,CAAAA,YAoFJ,IAAMC,EAAQ,IArEd,MAKIC,aAAc,MAJdC,UAAAA,CAAa,QAEbC,QAAAA,CAAiCC,KAAAA,OASjCC,OAAAA,CAAU,SAAY,CAClB,IAAMC,EAAO,MAAMC,CAAAA,EAAAA,EAAAA,EAAAA,EAAS,CAAEC,OAAQ,MAAO,GACxCF,IAILG,CAAAA,EAAAA,EAAAA,CAAAA,EAAY,IAAM,CACd,IAAI,CAACP,UAAU,CAAG,GAClB,IAAI,CAACC,QAAQ,CAAG,CACZO,SAAUJ,EAAKK,IAAI,CACnBC,MAAOhB,EAAMC,SAAS,CACtBgB,aAAc,EACdC,UAAWR,EAAKS,IAAI,CACpBC,MAAO,CACX,CACJ,GAEA,MAAMC,CAAAA,EAAAA,EAAAA,EAAAA,EAAiBX,GAClBY,WAAW,CAAC,IAAIC,EAAAA,EAAWA,CAACC,EAAAA,EAAwBA,GACpDF,WAAW,CACR,IAAIG,EAAAA,EAAcA,CACdC,CAAAA,EAAAA,EAAAA,EAAAA,EAAO,GAAc,CACbC,IAAajB,EAAKS,IAAI,CACtB,IAAI,CAACZ,QAAQ,CAAG,CACZO,SAAUJ,EAAKK,IAAI,CACnBC,MAAOhB,EAAMC,SAAS,CACtBgB,aAAcU,EACdT,UAAWR,EAAKS,IAAI,CACpBC,MAAOO,EAAYjB,EAAKS,IAAI,CAAI,EACpC,EAEA,IAAI,CAACZ,QAAQ,CAAG,CACZO,SAAUJ,EAAKK,IAAI,CACnBC,MAAOhB,EAAME,UAAU,CACvBe,aAAcU,EACdT,UAAWR,EAAKS,IAAI,CACpBC,MAAO,EACX,CAER,KAGPQ,MAAM,CAACC,EAAAA,CAAAA,CAAAA,MAAAA,CAAAA,OAA4B,IAExChB,CAAAA,EAAAA,EAAAA,CAAAA,EAAY,IAAM,CACd,IAAI,CAACN,QAAQ,CAAG,CACZO,SAAUJ,EAAKK,IAAI,CACnBC,MAAOhB,EAAMG,SAAS,CACtBc,aAAcP,EAAKS,IAAI,CACvBD,UAAWR,EAAKS,IAAI,CACpBC,MAAO,CACX,EACA,IAAI,CAACd,UAAU,CAAG,EACtB,GACJ,EA5DIwB,CAAAA,EAAAA,EAAAA,EAAAA,EAAmB,IAAI,CAAE,CACrBvB,SAAUwB,EAAAA,EAAAA,CAAAA,GAAc,CACxBtB,QAAS,EACb,EACJ,CAyDJ,EAIMuB,EAAoB,IAElB,GAAAC,EAAAC,IAAA,EAACC,EAAAA,CAAKA,CAAAA,CAAE,GAAGC,EAAAA,EAAe,WACtB,GAAAH,EAAAI,GAAA,EAACC,IAAIA,UACD,GAAAL,EAAAI,GAAA,EAACE,QAAAA,UAAM,wCAGX,GAAAN,EAAAI,GAAA,EAACF,EAAAA,CAAKA,CAAAA,CAACK,WAAU,YACb,GAAAP,EAAAI,GAAA,EAACI,EAAAA,CAAaA,CAAAA,CACVC,SAAU,CAACb,EAAAA,CAAAA,CAAAA,MAAmB,EAAIzB,EAAME,UAAU,CAClDqC,KAAK,OACLC,QAASxC,EAAMK,OAAO,KAI7BL,EAAMG,QAAQ,EACX,GAAA0B,EAAAI,GAAA,EAACQ,EAAAA,CAAiBA,CAAAA,CACdC,OAAQ,CAAEC,KAAM,CAAEC,MAAO,GAAI,CAAE,EAC/BC,MAAO7C,EAAMG,QAAQ,CAACO,QAAQ,CAC9BoC,gBAAiB9C,EAAMG,QAAQ,CAACa,KAAK,CACrC+B,YAAanD,CAAK,CAACI,EAAMG,QAAQ,CAACS,KAAK,CAAC,KAO5DoC,CAAAA,EAAA,QAAeC,CAAAA,EAAAA,EAAAA,EAAAA,EAASrB","sources":["webpack://_N_E/?a8dd","webpack://_N_E/./src/pages/install.tsx","webpack://_N_E/<anon>"],"sourcesContent":["\n    (window.__NEXT_P = window.__NEXT_P || []).push([\n      \"/install\",\n      function () {\n        return require(\"private-next-pages/install.tsx\");\n      }\n    ]);\n    if(module.hot) {\n      module.hot.dispose(function () {\n        window.__NEXT_P.push([\"/install\"])\n      });\n    }\n  ","import { DefaultButton, ProgressIndicator, Stack } from \"@fluentui/react\";\nimport { ADB_SYNC_MAX_PACKET_SIZE } from \"@yume-chan/adb\";\nimport { ChunkStream } from \"@yume-chan/stream-extra\";\nimport { action, makeAutoObservable, observable, runInAction } from \"mobx\";\nimport { observer } from \"mobx-react-lite\";\nimport { NextPage } from \"next\";\nimport Head from \"next/head\";\nimport { GLOBAL_STATE } from \"../state\";\nimport {\n    ProgressStream,\n    RouteStackProps,\n    createFileStream,\n    pickFile,\n} from \"../utils\";\n\nenum Stage {\n    Uploading,\n\n    Installing,\n\n    Completed,\n}\n\ninterface Progress {\n    filename: string;\n\n    stage: Stage;\n\n    uploadedSize: number;\n\n    totalSize: number;\n\n    value: number | undefined;\n}\n\nclass InstallPageState {\n    installing = false;\n\n    progress: Progress | undefined = undefined;\n\n    constructor() {\n        makeAutoObservable(this, {\n            progress: observable.ref,\n            install: false,\n        });\n    }\n\n    install = async () => {\n        const file = await pickFile({ accept: \".apk\" });\n        if (!file) {\n            return;\n        }\n\n        runInAction(() => {\n            this.installing = true;\n            this.progress = {\n                filename: file.name,\n                stage: Stage.Uploading,\n                uploadedSize: 0,\n                totalSize: file.size,\n                value: 0,\n            };\n        });\n\n        await createFileStream(file)\n            .pipeThrough(new ChunkStream(ADB_SYNC_MAX_PACKET_SIZE))\n            .pipeThrough(\n                new ProgressStream(\n                    action((uploaded) => {\n                        if (uploaded !== file.size) {\n                            this.progress = {\n                                filename: file.name,\n                                stage: Stage.Uploading,\n                                uploadedSize: uploaded,\n                                totalSize: file.size,\n                                value: (uploaded / file.size) * 0.8,\n                            };\n                        } else {\n                            this.progress = {\n                                filename: file.name,\n                                stage: Stage.Installing,\n                                uploadedSize: uploaded,\n                                totalSize: file.size,\n                                value: 0.8,\n                            };\n                        }\n                    })\n                )\n            )\n            .pipeTo(GLOBAL_STATE.device!.install());\n\n        runInAction(() => {\n            this.progress = {\n                filename: file.name,\n                stage: Stage.Completed,\n                uploadedSize: file.size,\n                totalSize: file.size,\n                value: 1,\n            };\n            this.installing = false;\n        });\n    };\n}\n\nconst state = new InstallPageState();\n\nconst Install: NextPage = () => {\n    return (\n        <Stack {...RouteStackProps}>\n            <Head>\n                <title>Install APK - Android Web Toolbox</title>\n            </Head>\n\n            <Stack horizontal>\n                <DefaultButton\n                    disabled={!GLOBAL_STATE.device || state.installing}\n                    text=\"Open\"\n                    onClick={state.install}\n                />\n            </Stack>\n\n            {state.progress && (\n                <ProgressIndicator\n                    styles={{ root: { width: 300 } }}\n                    label={state.progress.filename}\n                    percentComplete={state.progress.value}\n                    description={Stage[state.progress.stage]}\n                />\n            )}\n        </Stack>\n    );\n};\n\nexport default observer(Install);\n"],"names":["window","__NEXT_P","push","__webpack_require__","Stage","Uploading","Installing","Completed","state","constructor","installing","progress","undefined","install","file","pickFile","accept","runInAction","filename","name","stage","uploadedSize","totalSize","size","value","createFileStream","pipeThrough","ChunkStream","ADB_SYNC_MAX_PACKET_SIZE","ProgressStream","action","uploaded","pipeTo","GLOBAL_STATE","makeAutoObservable","observable","Install","react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__","jsxs","Stack","RouteStackProps","jsx","Head","title","horizontal","DefaultButton","disabled","text","onClick","ProgressIndicator","styles","root","width","label","percentComplete","description","__webpack_exports__","observer"],"sourceRoot":""}